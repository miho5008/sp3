@{
    WebSecurity.RequireAuthenticatedUser();
    if(!Roles.GetRolesForUser(WebSecurity.CurrentUserId.ToString()).Contains("employee")){
        Response.Redirect("~/");
    }
    WebSecurity.RequireRoles("employee");
    
    Layout = "~/_SiteLayout.cshtml";
    Page.Title = "Employee Page";
}

@{
    // registration submission
    if(IsPost){
        
        switch(Request["regsubmit"]){
            case "self":
                String stopdate = Request["regval_stopdate"];
                Database.Open("sp3").Query(
                    "INSERT INTO registrations"
                    +" (userid, ipaddress, action, time, stoptime)"
                    +" VALUES"
                    +" (@0, @1, 2, (@2), (@3))", 
                    new String[]{
                        WebSecurity.CurrentUserId.ToString(),
                        Request.UserHostAddress.ToString(),
                        DateTime.Now.ToString(),
                        stopdate}
                );
                break;
            case "child":
                String childpnr = Request["regval_childpnr"];
                Database.Open("sp3").Query(
                    "INSERT INTO registrations"
                    +" (userid, ipaddress, action, time, childpnr)"
                    +" VALUES"
                    +" (@0, @1, 1, (@2), (@3))", 
                    new String[]{
                        WebSecurity.CurrentUserId.ToString(),
                        Request.UserHostAddress.ToString(),
                        DateTime.Now.ToString(),
                        childpnr}
                );
            break;
        }
        
    } 
}

<div>
    <h1>employee page</h1>
    @{
        switch(Request["regtype"]){
            case "self":
                <h2>register non-attendance</h2>
                <form id="register_self" method="post">
                    <label for="datepicker">date - (MM/DD/YYYY)</label>
                    <input type="text" id="datepicker" name="regval_stopdate"/>
                    <button name="regsubmit" value="self">register</button>
                </form>    
                break;
            case "child":
                <h2>register non-attendance due to sick child</h2>
                <form id="register_child" method="post">
                    <label for="input_childnr" >child pnr</label>
                    <input id="input_childnr"type ="text" name="regval_childpnr" />
                    <button name="regsubmit" value="child">register</button>
                </form>
                break;
            default:
                // display choice menu of register types
                <form action="~/Employee">
                    <button id="btn_self" name="regtype" value="self">register self</button>
                    <button id="btn_child" name="regtype" value="child">register child</button>
                </form>
                break;
        }
    }

</div>
